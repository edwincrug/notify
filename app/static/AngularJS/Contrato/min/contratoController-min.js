registrationModule.controller("contratoController",function(e,t,n,o,i,a){t.newCliente=_Cliente,e.labelNewSucursal="Del Valle 1",e.labelNewTipo="Virtual",e.labelNewTipoPersona="Persona Física";var l=function(e,t,n,o){a.error("Ocurrio un problema "+e.message)};e.NuevoContrato=function(){t.newCliente.grupoEstadistico1=2,t.newCliente.idSucursal=1,t.newCliente.idTipo=1,t.newCliente.RFC="",t.newCliente.nota="",$("#newCliente").modal("show")};var r=function(t,o){a.info("Agregando el cliente a las búsquedas."),n.set("clientes",t),e.clientes=n.get("clientes")},s=function(o,i){a.success("Cliente agregado correctamente"),e.listaTempdeClientes=o,n.set("listadeClientes",o),e.cliente=Enumerable.From(e.listaTempdeClientes).Where(function(t){return t.idActa==e.idActaNew}).OrderBy(function(e){return e.idActa}).Select(function(e){return e}).FirstOrDefault(),t.cliente=e.cliente,n.set("clienteActual",t.cliente),$("#btnNuevoContrato").button("reset"),$("#newCliente").modal("hide"),location.href="/home"},u=function(t,n,i,u){a.info("El número de folio del nuevo cliente es: "+t),e.idActaNew=t,a.info("Configurando nuevo cliente en el sistema (Esto puede tardar varios minutos)..."),o.getFull().success(s).error(l),o.getAutocomplete().success(r).error(l)};e.GuardaNuevoContrato=function(){a.info("Agregando al nuevo cliente..."),$("#btnNuevoContrato").button("loading"),t.empleado=n.get("employeeLogged"),e.empleado=t.empleado,t.newCliente.idEmpleado=e.empleado.idEmpleado,i.add(t.newCliente).success(u).error(l)},e.SetNewSucursal=function(n,o){o.preventDefault(),o.stopPropagation(),e.status.isopennewsucursal=!e.status.isopennewsucursal,t.newCliente.idSucursal=n,e.labelNewSucursal=o.target.innerText},e.SetNewTipo=function(n,o){o.preventDefault(),o.stopPropagation(),e.status.isopennewtipo=!e.status.isopennewtipo,t.newCliente.grupoEstadistico1=n,e.labelNewTipo=o.target.innerText},e.SetNewTipoPersona=function(n,o){o.preventDefault(),o.stopPropagation(),e.status.isopenNewTipoPersona=!e.status.isopenNewTipoPersona,t.newCliente.idTipo=n,e.labelNewTipoPersona=o.target.innerText},e.MostrarContrato=function(){$("#newPDF").modal("show")};var c=function(e,t,n,o){$("#btnEmitirContrato").button("reset"),window.open(global_settings.urlReportContrato+e.replace(/"/g,""),"RptWindow","width=1024, height=768")};e.EmitirContrato=function(){t.empleado=n.get("employeeLogged"),e.empleado=t.empleado,e.cliente=n.get("clienteActual"),null!=e.PDFRepresentanteLegal?($("#btnEmitirContrato").button("loading"),i.getPDF(e.empleado.idEmpleado,e.cliente.idContrato,e.PDFRepresentanteLegal,e.cliente.idActa).success(c).error(l)):a.error("Debe establecer el nombre del representante legal.")},e.VerContrato=function(){var t=global_settings.urlReportContrato+e.cliente.idActa+".pdf";UrlExists(t)?(e.cliente=n.get("clienteActual"),window.open(t,"RptWindow","width=1024, height=768")):a.error("No existe contrato para este cliente.")},e.today=function(){t.newCliente.fechaInicio=new Date},e.today(),e.clear=function(){t.newCliente.fechaInicio=null},e.disabled=function(e,t){return"day"===t&&(-1===e.getDay()||7===e.getDay())},e.toggleMin=function(){e.minDate=e.minDate?null:(new Date).addYears(-1)},e.toggleMin(),e.openNew=function(t){t.preventDefault(),t.stopPropagation(),e.openedNew=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0]});