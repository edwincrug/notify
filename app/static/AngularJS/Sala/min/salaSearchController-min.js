registrationModule.controller("salaSearchController",function(e,o,t,a,n){function r(){}var i=function(o,t,a,n){e.listaReservacionesHoy1=o,e.lastUpdate=(new Date).format("dd/mm/yy hh:MM")},c=function(o,t,a,n){e.listaReservacionesHoy2=o,e.lastUpdate=(new Date).format("dd/mm/yy hh:MM")},s=function(e,o,t,a){n.error("Ocurrio un problema al obtener los datos.")};e.init=function(){e.today(),e.Reload(),o.empleado=a.get("employeeLogged"),e.empleado=o.empleado,e.listadeContactos=a.get("listadeContactos"),e.listadeClientes=a.get("listadeClientes");setInterval(function(){e.today(),e.Reload()},18e4)},e.Reload=function(){var o=e.dt.format("yyyymmddHHMM");e.myPromise=t.getReservacionHoy(1,o).success(i).error(s),e.myPromise=t.getReservacionHoy(2,o).success(c).error(s)},e.RecargaReservaciones=function(){e.Reload()};var l=function(o,t,a,r){n.success("La reservación se ha eliminado con éxito."),e.init()};e.EliminarReservacion=function(o){confirm("¿Desea quitar esta reservación de la lista? El consumo no se eliminará.")&&(e.myPromise=t.getReservacionQuitar(o.idReservacion,e.empleado.idEmpleado).success(l).error(s))},e.CancelarReservacion=function(o){e.cliente=Enumerable.From(e.listadeClientes).Where(function(e){return e.idContrato==o.idContrato}).OrderBy(function(e){return e.idActa}).Select(function(e){return e}).FirstOrDefault(),e.listaContacto=Enumerable.From(e.listadeContactos).Where(function(o){return o.idActa==e.cliente.idActa}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),m(),e.reenviarDestinatario=e.cliente.razonSocial,e.idCancelaReservacion=o.idReservacion,e.motivoCancelaReservacion="",$("#rescancel").modal("show")};var d=function(o,t,a,r){null!=o?($("#btncancelarReservacion").button("reset"),$("#rescancel").modal("hide"),n.success("La reservación se ha cancelado con éxito."),e.init()):n.error("Error al obtener los registros.")};e.CancelarReservacionFinal=function(){var o=[];angular.forEach(e.gridOptions.selectedItems,function(e,t){o.push(e.mail)}),o.length>0?($("#btncancelarReservacion").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,o)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.objetoSala=_Sala,e.objetoSala.sala=e.idCancelaReservacion,e.objetoSala.idEmpleado=e.empleado.idEmpleado,e.objetoSala.contactos=e.listaContactoTemp,e.objetoSala.titulo=e.motivoCancelaReservacion,e.objetoSala.sucursal=1,t.cancelaReservacion(e.objetoSala).success(d).error(s)):n.error("Debe seleccionar un contacto.")};var u=function(o,t,a,r){n.success("Sala liberada."),e.Reload()};e.LiberarReservacion=function(o){8==e.empleado.idEmpleado||1==e.empleado.idEmpleado?confirm("¿Desea liberar la sala?")&&t.changeStage(o.idReservacion,2).success(u).error(s):n.info("Debe pertenecer al departamento de cobranza para confirmar el pago.")},r.prototype.name="",r.prototype.mail="",e.myData=[],e.gridOptions={data:"myData",columnDefs:[{field:"name",displayName:"Nombre"},{field:"mail",displayName:"Correo"}],selectedItems:[],keepLastSelected:!1};var m=function(){e.myData=[],angular.forEach(e.listaContacto,function(e,o){var t=new r;t.name=e.nombre,t.mail=e.mail,""!=t.mail&&this.push(t)},e.myData)};e.today=function(){e.dt=new Date},e.clear=function(){e.dt=null},e.disabled=function(e,o){return"day"===o&&(-1===e.getDay()||7===e.getDay())},e.toggleMin=function(){e.minDate=e.minDate?null:(new Date).addYears(-1)},e.toggleMin(),e.open=function(o){o.preventDefault(),o.stopPropagation(),e.opened=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0]});
