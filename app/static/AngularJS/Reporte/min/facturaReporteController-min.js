registrationModule.controller("facturaReporteController",function(e,t,i,n,a){e.fechadesdeFactura=new Date,e.fechahastaFactura=new Date,e.init=function(){e.clienteTipo=0,e.labelClienteTipo="Vigentes"},e.VerCliente=function(t){e.gridOptions.selectRow(t,!0),e.clientever=e.gridOptions.$gridScope.selectedItems[0],e.listadeClientes=i.get("listadeClientes"),e.cliente=Enumerable.From(e.listadeClientes).Where(function(t){return t.idActa==e.clientever.cliente}).OrderBy(function(e){return e.idActa}).Select(function(e){return e}).FirstOrDefault(),i.set("clienteActual",e.cliente),window.open("/cobranza","MsgWindow","width=1024, height=768")};var o=function(e,t,i,n){a.error("Ocurrio un problema")};e.ProcesaReporte=function(){e.obtieneDatos()},e.ExportaReporte=function(){alert("Habilite MÃ³dulo 00xx545")},e.ExportarReporte=function(){$("#table2excel").table2excel({exclude:".noExl",name:"Reporte"})},e.Regresar=function(){location.href="/cobranza"},e.SetClienteTipo=function(t,i,n){i.preventDefault(),i.stopPropagation(),e.status.isopenClienteTipo=!e.status.isopenClienteTipo,e.clienteTipo=t,e.labelClienteTipo=n},e.today=function(){e.dt1=new Date,e.dt2=new Date},e.today(),e.clear=function(){e.dt1=null,e.dt2=null},e.disabled=function(e,t){return"day"===t&&(-1===e.getDay()||7===e.getDay())},e.toggleMin=function(){e.minDate=e.minDate?null:(new Date).addYears(-1)},e.toggleMin(),e.open1=function(t){t.preventDefault(),t.stopPropagation(),e.opened1=!0},e.open2=function(t){t.preventDefault(),t.stopPropagation(),e.opened2=!0},e.dateOptions={formatYear:"yy",startingDay:1},e.initDate=new Date("2016-15-20"),e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0],e.filterOptions={filterText:"",useExternalFilter:!1},e.pagingOptions={pageSizes:[10,20,30],pageSize:1e3,currentPage:1},e.setPagingData=function(t,i){if(e.listadeFuncionesAdicionales.length>0){var n=e.listadeFuncionesAdicionales.slice((t-1)*i,t*i);e.myData=n,e.totalServerItems=e.listadeFuncionesAdicionales.length,e.$$phase||e.$apply()}else e.totalServerItems=0,e.pagingOptions.currentPage=1,e.$$phase||e.$apply()},e.getPagedDataAsync=function(t,i,l,r){setTimeout(function(){if(r){var s=e.dt1.format("yyyymmdd"),c=e.dt2.format("yyyymmdd");e.myPromise=n.getFacturas(s,c,e.clienteTipo).success(function(n){e.listadeFuncionesAdicionales=n,e.listadeFuncionesAdicionalesFull=n,e.gridOptions.$gridScope.filterText="",e.setPagingData(i,t),0==e.listadeFuncionesAdicionales.length&&a.error("No se encontro ningun registro")}).error(o)}else if(l){e.filterText;var d=l.toLowerCase();e.listadeFuncionesAdicionales=e.listadeFuncionesAdicionalesFull.filter(function(e){return JSON.stringify(e).toString().toLowerCase().indexOf(d)}),e.sortData(e.gridOptions.sortInfo.fields[0],e.gridOptions.sortInfo.directions[0],l),e.setPagingData(i,t)}else e.listadeFuncionesAdicionales=e.listadeFuncionesAdicionalesFull,e.setPagingData(i,t);$('[data-toggle="tooltip"]').tooltip()},100)},e.obtieneDatos=function(){e.pagingOptions.currentPage=1,e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,"",!0)},e.$watch("gridOptions.$gridScope.filterText",function(t,i){t!==i&&(e.pagingOptions.currentPage=1,e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.gridOptions.$gridScope.filterText,!1))},!0),e.$watch("pagingOptions",function(t,i){(t!==i||t.currentPage!==i.currentPage||t.pageSize!=i.pageSize)&&(0!=e.totalServerItems?e.getPagedDataAsync(e.pagingOptions.pageSize,e.pagingOptions.currentPage,e.gridOptions.$gridScope.filterText,!1):t.currentPage=1)},!0),e.$watch("gridOptions.ngGrid.config.sortInfo",function(t,i){t!==i&&(t.fields[0]!==i.fields[0]||t.directions[0]!==i.directions[0])&&(e.sortData(t.fields[0],t.directions[0],e.gridOptions.$gridScope.filterText),e.setPagingData(e.pagingOptions.currentPage,e.pagingOptions.pageSize))},!0),e.sortData=function(t,i,n){if(e.listadeFuncionesAdicionales){if(n){e.filterText;var a=n.toLowerCase();e.listadeFuncionesAdicionales=e.listadeFuncionesAdicionales.filter(function(e){return JSON.stringify(e).toLowerCase().indexOf(a)})}e.listadeFuncionesAdicionales.sort(function(e,n){return"asc"==i?e[t]>n[t]?1:-1:e[t]>n[t]?-1:1})}},e.gridOptions={data:"myData",showGroupPanel:!1,jqueryUIDraggable:!0,showFilter:!0,showColumnMenu:!0,showFooter:!0,enableCellSelection:!1,enableRowSelection:!0,enableColumnResize:!0,enablePaging:!1,multiSelect:!1,selectedItems:[],totalServerItems:"totalServerItems",filterOptions:e.filterOptions,sortInfo:{fields:["folio"],directions:["asc"]},columnDefs:[{field:"cliente",displayName:"Cliente"},{field:"estatus",displayName:"Estatus"},{field:"nombre",displayName:"Nombre"},{field:"serie",displayName:"Serie"},{field:"folio",displayName:"Folio"},{field:"anterior",displayName:"Anterior"},{field:"pagos",displayName:"Pagos"},{field:"subtotal",displayName:"Subtotal"},{field:"iva",displayName:"IVA"},{field:"total",displayName:"Total"},{field:"fecha",displayName:"Fecha Factura"},{displayName:"Ver",cellTemplate:'<button type="button" class="btn btn-default glyphicon glyphicon-user" data-toggle="tooltip" data-placement="top" title="Ver cliente" ng-click="VerCliente(row.rowIndex);"></button>',width:50}]}});