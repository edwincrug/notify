registrationModule.controller("envioSignController",function(e,t,n,o,r){function i(){}e.currentEnvio=_Envio;var a=function(e,t,n,r){o.error("Ocurrio un problema al obtener los datos.")};e.init=function(){t.empleado=n.get("employeeLogged"),e.empleado=t.empleado,e.listadeContactos=n.get("listadeContactos"),e.listadeClientes=n.get("listadeClientes"),e.envio=n.get("envioEntrega"),e.comentarios="",e.cliente=Enumerable.From(e.listadeClientes).Where(function(t){return t.idContrato==e.envio.idContrato}).OrderBy(function(e){return e.idActa}).Select(function(e){return e}).FirstOrDefault(),e.listaContacto=Enumerable.From(e.listadeContactos).Where(function(t){return t.idActa==e.cliente.idActa}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),l();var o=(new Date).getTime();$("#firmaMonitor").attr("src",global_settings.urlSignature+o.toString()),e.currentEnvio.lugar=o.toString()};var c=function(t,n,r,i){e.isCollapsed=!e.isCollapsed,$("#btnFinalizarEnvio").button("reset"),o.success("Envio entregado correctamente."),location.href="/envioList"};e.FinalizarEntrega=function(){var t=[];angular.forEach(e.gridOptions.selectedItems,function(e,n){t.push(e.mail)}),t.length>0?($("#btnFinalizarEnvio").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,t)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.currentEnvio.contactos=e.listaContactoTemp,e.currentEnvio.idActa=e.envio.idEnvio,e.currentEnvio.idEmpleado=e.empleado.idEmpleado,e.currentEnvio.condiciones=e.comentarios,r.finalizaEnvio(e.currentEnvio).success(c).error(a)):o.error("Debe seleccionar un contacto.")},e.Cancelar=function(){location.href="/envioList"},i.prototype.name="",i.prototype.mail="",e.myData=[],e.gridOptions={data:"myData",columnDefs:[{field:"name",displayName:"Nombre"},{field:"mail",displayName:"Correo"}],selectedItems:[],keepLastSelected:!1};var l=function(){e.myData=[],angular.forEach(e.listaContacto,function(e,t){var n=new i;n.name=e.nombre,n.mail=e.mail,""!=n.mail&&this.push(n)},e.myData)}});