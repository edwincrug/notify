registrationModule.controller("facturaController",function(t,o,a,e,r,c){t.subtotal=0,t.iva=0,t.total=0;var n=function(o,a){c.info("Lista productos cargada"),t.productos=o,$("#tProducto").autocomplete({source:t.productos}),$("#tProducto").on("autocompleteselect",function(t,o){p(o.item.value)}).change()},u=function(o,a){t.listaProductos=o},d=function(o,a){t.factura=o,t.cuentaDePago="No Identificado",t.factura.formaDePago=0,t.factura.idEmpleado=1,t.factura.idContrato=t.cliente.idContrato,t.factura.observaciones=""},s=function(o,a){t.tempProducto=o},l=function(t,o,a,e){c.error("Ocurrio un problema")};t.init=function(){o.cliente=a.get("clienteActual"),t.cliente=o.cliente,t.myPromise=e.getEmpty().success(d).error(l),t.myPromise=e.getServicioEmpty().success(s).error(l),t.myPromise=r.getAutocomplete().success(n).error(l),t.myPromise=r.getProductos().success(u).error(l)},t.Clear=function(){t.semilla=""},t.Cancelar=function(){location.href="/cobranza"};var p=function(o){var a=mySplit(o,0,"|");t.producto=Enumerable.From(t.listaProductos).Where(function(t){return t.idProducto==a}).OrderBy(function(t){return t.idProducto}).Select(function(t){return t}).FirstOrDefault(),t.tempProducto.precio=t.producto.pesos,t.tempProducto.idProducto=t.producto.idProducto,t.tempProducto.descripcion=t.producto.descripcion,t.tempProducto.cantidad=1,t.$apply()};t.Agregar=function(){if(""!=t.tempProducto.descripcion&&null!=t.tempProducto.descripcion){var o=t.factura.listaServicios.length,a={id:0,idProducto:0,descripcion:"",cantidad:0,precio:0};a.id=o+1,a.descripcion=t.tempProducto.descripcion,a.idProducto=t.tempProducto.idProducto,a.cantidad=t.tempProducto.cantidad,a.precio=t.tempProducto.precio,t.factura.listaServicios.push(a),f(),t.tempProducto.descripcion="",t.tempProducto.idProducto=0,t.tempProducto.cantidad=1,t.tempProducto.precio=0,t.semilla=""}else c.warning("Elija un producto.")},t.Eliminar=function(o){var a=-1;for(i=0;i<t.factura.listaServicios.length;i++)if(t.factura.listaServicios[i].id==o){a=i;break}t.factura.listaServicios.splice(a,1),f()};var f=function(){for(t.subtotal=0,i=0;i<t.factura.listaServicios.length;i++)t.subtotal+=t.factura.listaServicios[i].cantidad*t.factura.listaServicios[i].precio;t.iva=.16*t.subtotal,t.total=1.16*t.subtotal},m=function(t,o){var a=t;t.length<10?(c.success("Factura Generada."),setTimeout(function(){location.href="/cobranza"},2e3)):c.error("Ha ocurrido un error al procesar la factura: "+t)};t.Procesar=function(){0!=t.factura.formaDePago?confirm("¿Desea procesar la factura por un importe total de: "+t.total+"?")&&(t.factura.cuenta=1,t.factura.desde=t.dtDesde,t.factura.hasta=t.dtHasta,t.myPromise=e.eventual(t.factura).success(m).error(l)):c.warning("Elija una forma de pago.")},t.today=function(){t.dtDesde=new Date,t.dtHasta=new Date},t.today(),t.clear=function(){t.dtDesde=null,t.dtHasta=null},t.disabled=function(t,o){return"day"===o&&(-1===t.getDay()||7===t.getDay())},t.toggleMin=function(){t.minDate=t.minDate?null:(new Date).addYears(-1)},t.toggleMin(),t.openDesde=function(o){o.preventDefault(),o.stopPropagation(),t.openedDesde=!0},t.openHasta=function(o){o.preventDefault(),o.stopPropagation(),t.openedHasta=!0},t.dateOptions={formatYear:"yy",startingDay:1},t.initDate=new Date("2016-15-20"),t.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],t.format=t.formats[0],t.SetPago=function(o,a,e){a.preventDefault(),a.stopPropagation(),t.status.isopen=!t.status.isopen,t.factura.formaDePago=o,t.labelDrop=e},t.labelDrop="Seleccione Una Opción"});