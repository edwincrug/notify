registrationModule.controller("clienteController",function(e,o,t,a,n,r,i,c,s,l,d,u,m,p,f,g,C,b){function v(){o.listadeClientes||B(),e.cliente=Enumerable.From(o.listadeClientes).Where(function(o){return o.idActa==e.idCliente}).OrderBy(function(e){return e.idActa}).Select(function(e){return e}).FirstOrDefault(),o.cliente=e.cliente,t.set("clienteActual",o.cliente),e.listaServicio=Enumerable.From(o.listadeServicios).Where(function(o){return o.idActa==e.cliente.idActa}).OrderBy(function(e){return e.idContratoPlan}).Select(function(e){return e}).ToArray(),e.listaContacto=Enumerable.From(o.listadeContactos).Where(function(o){return o.idActa==e.cliente.idActa}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),t.set("listaContacto",e.listaContacto),e.listaDireccion=Enumerable.From(o.listadeDirecciones).Where(function(o){return o.idActa==e.cliente.idActa}).OrderBy(function(e){return e.idDireccion}).Select(function(e){return e}).ToArray(),2==e.cliente.idEstatusContrato&&$("#cancelCustomer").modal("show")}function y(o){e.idCliente=mySplit(o,0,"|"),$("#searchEmpresa").val(""),$("#search").val(""),v(),e.$apply()}function h(){}function E(){}function D(){}function S(){}e.semilla="",e.semillaServicio="",e.base=!0,e.info="",e.radioCorrespondenciaModel=null;var A=function(e,o){a.info("Clientes cargados"),t.set("listadeClientes",e),$("#btnSingIn").show(),$("#btnSingIn").button("reset"),$("#dynamic").remove(),$("#login").trigger("click"),B()},w=function(e,o){a.info("Contactos cargados"),t.set("listadeContactos",e)},T=function(e,o){a.info("Direcciones cargadas"),t.set("listadeDirecciones",e)},L=function(e,o){a.info("Servicios cargados"),t.set("listadeServicios",e)},R=function(e,o){a.info("Productos cargados"),t.set("listaProductos",e)},O=function(e,o){a.info("Lista de clientes cargada"),t.set("clientes",e)},P=function(e,o){a.info("Lista de contactos cargada"),t.set("contactos",e)},z=function(e,o){a.info("Lista de productos cargada"),t.set("productosConsumo",e)},M=function(e,o){t.set("tempProducto",e)},k=function(e,o,t,n){a.error("Ocurrio un problema")},I=function(){c.getAutocomplete().success(O).error(k),s.getAuto().success(P).error(k),d.getAutocomplete().success(z).error(k),s.getAll().success(w).error(k),l.get().success(T).error(k),d.getServicios().success(L).error(k),d.getProductos().success(R).error(k),c.getFull().success(A).error(k),u.get(0).success(W).error(k),m.getR(0).success(q).error(k),m.getE(0).success(V).error(k),d.getServicioEmpty().success(M).error(k);var e=new Date;t.set("ultimaCarga",e)},F=function(){var e=t.get("ultimaCarga"),o=!1;return e&&(o=!0),o};e.usuario="",e.password="";var N=function(e,n){a.info("Bienvenido "+e.nombre+" "+e.apellidoPaterno+" No has iniciado sesión el los últimos días. esatmos actualizando la información."),o.empleado=e,t.set("employeeLogged",o.empleado);var r=$('<img id="dynamic" />');r.attr("src","Images/gif/loading.gif"),r.appendTo("#imageDiv"),$("#btnSingIn").hide(),t.get("employeeLogged")&&F()||I()};e.Iniciar=function(){""!=e.usuario&&""!=e.password?($("#btnSingIn").button("loading"),n.get(e.usuario,e.password).success(N).error(k)):a.error("Introduzca un usuario y/o password.")};var B=function(){o.empleado=t.get("employeeLogged"),e.empleado=o.empleado,o.listadeClientes=t.get("listadeClientes"),o.listadeContactos=t.get("listadeContactos"),o.listadeDirecciones=t.get("listadeDirecciones"),o.listadeServicios=t.get("listadeServicios"),o.listaProductos=t.get("listaProductos"),o.clientes=t.get("clientes"),$("#searchEmpresa").autocomplete({source:o.clientes}),o.contactos=t.get("contactos"),$("#search").autocomplete({source:o.contactos}),o.productosConsumo=t.get("productosConsumo"),e.tempProducto=t.get("tempProducto"),e.cliente=t.get("clienteActual"),e.cliente&&(e.idCliente=e.cliente.idActa),e.correoLlamadaTemplate=t.get("correoLlamadaTemplate"),e.correoLlamada=t.get("correoLlamada"),e.correspondenciaRecibidaTemplate=t.get("correspondenciaRecibidaTemplate"),e.correspondenciaRecibida=t.get("correspondenciaRecibida"),e.correspondenciaEntregadaTemplate=t.get("correspondenciaEntregadaTemplate"),e.correspondenciaEntregada=t.get("correspondenciaEntregada")};e.init=function(){$('[data-toggle="tooltip"]').tooltip(),$("#web").popover({html:!0,content:function(){return $("#popOverCuentaWeb").html()}}),$("#btnLlamadas").popover({html:!0,content:function(){return $("#popoverExampleTwoHiddenContent").html()},title:function(){return $("#popoverExampleTwoHiddenTitle").html()}}),$("#searchEmpresa").on("autocompleteselect",function(e,o){y(o.item.value)}).change(),$("#tServicio").on("autocompleteselect",function(e,o){j(o.item.value)}).change(),$("#tConsumo").on("autocompleteselect",function(e,o){j(o.item.value)}).change(),$("#search").on("autocompleteselect",function(e,o){y(o.item.value)}).change(),t.get("employeeLogged")&&F()?(B(),v()):($("#btnSingIn").show(),$("#logon").trigger("click"))},e.Clear=function(){e.semilla=""};var j=function(t){var a=mySplit(t,0,"|");e.producto=Enumerable.From(o.listaProductos).Where(function(e){return e.idProducto==a}).OrderBy(function(e){return e.idProducto}).Select(function(e){return e}).FirstOrDefault(),e.tempProducto.precio=e.producto.pesos,e.tempProducto.idProducto=e.producto.idProducto,e.tempProducto.descripcion=e.producto.descripcion,e.tempProducto.cantidad=1,e.$apply(),$(".currencii").formatCurrency()};e.Mensaje=function(){a.success("Hola")},e.AbrirTarjeta=function(o){e.contacto=o,$("#cardContact").modal("show")},e.AccionNoPermitida=function(){a.error("No cuenta con el servicio.")};var W=function(o,a){e.correoLlamadaTemplate=o,e.correoLlamada=e.correoLlamadaTemplate,t.set("correoLlamadaTemplate",e.correoLlamadaTemplate),t.set("correoLlamada",e.correoLlamada)},G=function(o,t,n,r){o>0?(a.success("Mensaje Enviado"),e.correoLlamada=e.correoLlamadaTemplate,angular.forEach(e.myData,function(o,t){e.gridOptions.selectItem(t,!1)}),$("#btnCorreoLlamada").button("reset"),$("#btnCorreoGeneral").button("reset"),e.correoLlamada.mensaje="",e.correoLlamada.telefonoContacto="",e.correoLlamada.correoContacto="",e.correoLlamada.nombreContacto="",$(".checkContacto input:radio").removeAttr("checked"),$(".checkTelefono input:radio").removeAttr("checked"),$(".checkCorreo input:radio").removeAttr("checked"),$(".checkMail input:checkbox").removeAttr("checked"),$("#fastMessage").modal("hide"),$("#generalMessage").modal("hide")):a.error("Algo va mal. Verifique su conexión.")},H=function(e,t){null!=e?(o.listaBuzon=e,a.success("Mensajes cargados.")):a.error("Error al obtener los registros.")};e.MostrarCorreoGeneral=function(){null!=e.cliente&&""!=e.cliente?(e.myData=[],angular.forEach(e.listaContacto,function(e,o){var t=new h;t.name=e.nombre,t.mail=e.mail,""!=t.mail&&this.push(t)},e.myData),$("#generalMessage").modal("show")):a.error("Debe seleccionar un cliente.")},e.EnviarCorreoGeneral=function(){var o=[];angular.forEach(e.gridOptions.selectedItems,function(e,t){o.push(e.mail)}),o.length>0?($("#btnCorreoGeneral").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,o)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.correoLlamada.contactos=e.listaContactoTemp,e.correoLlamada.idContrato=e.cliente.idContrato,e.correoLlamada.idEmpleado=e.empleado.idEmpleado,u.add(e.correoLlamada).success(G).error(k),e.cliente.correo=e.cliente.correo+1):a.error("Debe seleccionar un contacto.")},e.MostrarCorreoLlamada=function(){null!=e.cliente&&""!=e.cliente?(e.myData=[],angular.forEach(e.listaContacto,function(e,o){var t=new h;t.name=e.nombre,t.mail=e.mail,""!=t.mail&&this.push(t)},e.myData),$("#fastMessage").modal("show")):a.error("Debe seleccionar un cliente.")},e.EnviarCorreoLlamada=function(){var o=[];angular.forEach(e.gridOptions.selectedItems,function(e,t){o.push(e.mail)}),o.length>0?($("#btnCorreoLlamada").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,o)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.correoLlamada.contactos=e.listaContactoTemp,e.correoLlamada.idContrato=e.cliente.idContrato,e.correoLlamada.idEmpleado=e.empleado.idEmpleado,null!=$(".checkContacto input:radio:checked").val()&&(e.correoLlamada.opcionNombre=$(".checkContacto input:radio:checked").val()),null!=$(".checkMail input:checkbox:checked").val()&&(e.correoLlamada.opcionMensaje=$(".checkMail input:checkbox:checked").val()),null!=$(".checkTelefono input:radio:checked").val()&&(e.correoLlamada.opcionTelefono=$(".checkTelefono input:radio:checked").val()),null!=$(".checkCorreo input:radio:checked").val()&&(e.correoLlamada.opcionCorreo=$(".checkCorreo input:radio:checked").val()),u.put(e.correoLlamada).success(G).error(k),e.cliente.correo=e.cliente.correo+1):a.error("Debe seleccionar un contacto.")},e.AdminBuzon=function(){if(null!=e.cliente&&""!=e.cliente){var t=(new Date).addDays(-7).format("yyyymmdd"),n=(new Date).format("yyyymmdd");o.listaBuzon=null,u.getAll(e.cliente.idContrato,t,n).success(H).error(k),$("#viewBuzon").modal("show")}else a.error("Debe seleccionar un cliente.")},e.VerMensaje=function(e){$("#viewMensaje").modal("show"),$("#mensajeContent").html(e.cuerpo)},e.ReenviarMensaje=function(o){$("#viewBuzon").modal("hide"),Se(),e.reenviarDestinatario=e.cliente.razonSocial,e.reenviarID=o.idCorreo,$("#reesend").modal("show")};var x=function(o,t,n,r){o>0?(a.success("Mensaje re-enviado"),e.correoLlamada=e.correoLlamadaTemplate,angular.forEach(e.myData,function(o,t){e.gridOptions.selectItem(t,!1)}),$("#btnReesend").button("reset"),$("#reesend").modal("hide")):a.error("Algo va mal. Verifique su conexión.")};e.ReenviarMensajeFinal=function(o){var t=[];angular.forEach(e.gridOptions.selectedItems,function(e,o){t.push(e.mail)}),t.length>0?($("#btnReesend").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,t)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.correoLlamada.contactos=e.listaContactoTemp,e.correoLlamada.idContrato=e.reenviarID,e.correoLlamada.idEmpleado="999",u.put(e.correoLlamada).success(x).error(k),e.cliente.correo=e.cliente.correo+1):a.error("Debe seleccionar un contacto.")};var q=function(o,a){e.correspondenciaRecibidaTemplate=o,e.correspondenciaRecibida=e.correspondenciaRecibidaTemplate,t.set("correspondenciaRecibidaTemplate",e.correspondenciaRecibidaTemplate),t.set("correspondenciaRecibida",e.correspondenciaRecibida)},V=function(o,a){e.correspondenciaEntregadaTemplate=o,e.correspondenciaEntregada=e.correspondenciaEntregadaTemplate,t.set("correspondenciaEntregadaTemplate",e.correspondenciaEntregadaTemplate),t.set("correspondenciaEntregada",e.correspondenciaEntregada)},_=function(o,t,n,r){o>0?(a.success("Correspondencia Notificada"),e.correspondenciaRecibida=e.correspondenciaRecibidaTemplate,angular.forEach(e.myData,function(o,t){e.gridOptions.selectItem(t,!1)}),$("#btnEnviarCorrespondencia").button("reset"),$("#newCorrespondencia").modal("hide")):a.error("Algo va mal. Verifique su conexión.")},U=function(e,t,n,r){null!=e?(o.listaCorrespondenciaRecibida=e,a.success("Correspondencia recibida cargada.")):a.error("Error al obtener los registros.")},Y=function(e,t,n,r){null!=e?(o.listaCorrespondenciaEntregada=e,a.success("Correspondencia entregada cargada.")):a.error("Error al obtener los registros.")},Q=function(o,t,n,r){o>0?(a.success("Correspondencia Entregada"),e.correspondenciaEntregada=e.correspondenciaEntregadaTemplate,angular.forEach(e.myData,function(o,t){e.gridOptions.selectItem(t,!1)}),angular.forEach(e.myAlmacen,function(o,t){e.gridAlmacen.selectItem(t,!1)}),$("#btnEntregarCorrespondencia").button("reset"),$("#entCorrespondencia").modal("hide")):a.error("Ocurrio un error al guardar.")};e.ShowEntregarCorrespondencia=function(o){e.correspondenciaActual=o,e.correspondenciaEntregada.idCorrespondencia=e.correspondenciaActual.idCorrespondencia,e.correspondenciaEntregada.idContrato=e.correspondenciaActual.idContrato,e.correspondenciaEntregada.idEmpleado=e.empleado.idEmpleado,$("#viewCorrespondencia").modal("hide"),Se(),e.myAlmacen=[],angular.forEach(e.listaCorrespondenciaRecibida,function(o,t){var a=new E;a.id=o.idCorrespondencia,a.fecha=o.fechaRecibida,a.tipo=o.tipo,a.material=o.material,a.almacenamiento=o.almacenamiento,o.tipo==e.correspondenciaActual.tipo&&this.push(a)},e.myAlmacen),e.correspondenciaEntregada.recibe="",e.correspondenciaEntregada.comentarios="";var t=(new Date).getTime();e.correspondenciaEntregada.firma=t.toString(),$("#firmaCorrespondencia").attr("src",global_settings.urlSignature+t.toString()),$("#entCorrespondencia").modal("show")},e.EntregarCorrespondencia=function(o){var t=[];angular.forEach(e.gridOptions.selectedItems,function(e,o){t.push(e.mail)});var n="";angular.forEach(e.gridAlmacen.selectedItems,function(e,o){n+=e.id+","}),t.length>0&&n.length>0?($("#btnEntregarCorrespondencia").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,t)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.correspondenciaEntregada.contactos=e.listaContactoTemp,e.correspondenciaEntregada.material=n,m.add(e.correspondenciaEntregada).success(Q).error(k),e.cliente.correspondencia=e.cliente.correspondencia-1):a.error("Debe seleccionar un contacto y/o material.")},e.MostrarCorrespondencia=function(){if(null!=e.cliente&&""!=e.cliente){$("#viewCorrespondencia").modal("hide"),Se(),e.correspondenciaRecibida.material="",e.correspondenciaRecibida.almacenamiento="",e.correspondenciaRecibida.observaciones="",e.radioCorrespondenciaModel="Correspondencia";var o=(new Date).format("yyyymmdd"),t=(new Date).format("yyyymmdd");m.getRecibida(e.cliente.idContrato,o,t).success(U).error(k),$("#newCorrespondencia").modal("show")}else a.error("Debe seleccionar un cliente.")};var J=function(o,t,n,r){var i=(new Date).format("yyyymmdd"),c=(new Date).format("yyyymmdd");m.getRecibida(e.cliente.idContrato,i,c).success(U).error(k),a.success("El paquete se ha eliminado con éxito del almacén.")};e.CancelarCorrespondencia=function(o){confirm("¿Desea eliminar el registro de correspondencia para este cliente?")&&m.cancelar(o.idCorrespondencia,e.empleado.idEmpleado).success(J).error(k)};var K=function(o){var t=!0;return 1>o&&(a.error("Debe seleccionar un contacto."),t=!1),e.radioCorrespondenciaModel||(a.error("Debe elegir el tipo de objeto recibido: Corrrespondencia ó EMPE."),t=!1),!e.correspondenciaRecibida.material.length>0&&(a.error("Debe capturar el material recibido."),t=!1),!e.correspondenciaRecibida.almacenamiento.length>0&&(a.error("Debe capturar el lugar de almacenamiento."),t=!1),t};e.EnviarCorrespondencia=function(){var o=[];angular.forEach(e.gridOptions.selectedItems,function(e,t){o.push(e.mail)}),K(o.length)&&($("#btnEnviarCorrespondencia").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,o)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.correspondenciaRecibida.contactos=e.listaContactoTemp,e.correspondenciaRecibida.idContrato=e.cliente.idContrato,e.correspondenciaRecibida.idEmpleado=e.empleado.idEmpleado,"Correspondencia"==e.radioCorrespondenciaModel?e.correspondenciaRecibida.tipo=1:e.correspondenciaRecibida.tipo=2,m.put(e.correspondenciaRecibida).success(_).error(k),e.cliente.correspondencia=e.cliente.correspondencia+1)},e.AdminCorrespondencia=function(){if(null!=e.cliente&&""!=e.cliente){$("#myTabCorrrespondencia a").click(function(e){e.preventDefault(),$(this).tab("show")});var t=(new Date).format("yyyymmdd"),n=(new Date).format("yyyymmdd");o.listaCorrespondenciaRecibida=null,o.listaCorrespondenciaEntregada=null,m.getRecibida(e.cliente.idContrato,t,n).success(U).error(k),m.getEntregada(e.cliente.idContrato,t,n).success(Y).error(k),$("#viewCorrespondencia").modal("show")}else a.error("Debe seleccionar un cliente.")};var X=function(e,t,n,r){null!=e?(o.listaReservacion=e,a.success("Reservaciones cargadas.")):a.error("Error al obtener los registros.")},Z=function(e,t,n,r){null!=e?(o.listaEvento=e,a.success("Eventos cargados.")):a.error("Error al obtener los registros.")};e.Reservar=function(){location.href="/salaMain"},e.CancelarReservacion=function(o){$("#showSala").modal("hide"),Se(),e.reenviarDestinatario=e.cliente.razonSocial,e.idCancelaReservacion=o.idReservacion,e.motivoCancelaReservacion="",$("#rescancel").modal("show")};var ee=function(e,o,t,n){null!=e?($("#btncancelarReservacion").button("reset"),$("#rescancel").modal("hide"),a.success("La reservación se ha cancelado con éxito.")):a.error("Error al obtener los registros.")};e.CancelarReservacionFinal=function(){var o=[];angular.forEach(e.gridOptions.selectedItems,function(e,t){o.push(e.mail)}),o.length>0?($("#btncancelarReservacion").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,o)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.objetoSala=_Sala,e.objetoSala.sala=e.idCancelaReservacion,e.objetoSala.idEmpleado=e.empleado.idEmpleado,e.objetoSala.contactos=e.listaContactoTemp,e.objetoSala.titulo=e.motivoCancelaReservacion,e.objetoSala.sucursal=1,b.cancelaReservacion(e.objetoSala).success(ee).error(k)):a.error("Debe seleccionar un contacto.")},e.AdminSala=function(){if(null!=e.cliente&&""!=e.cliente){$("#myTabSala a").click(function(e){e.preventDefault(),$(this).tab("show")}),o.listaReservacion=null,o.listaEvento=null;var t=(new Date).addDays(-7).format("yyyymmdd"),n=(new Date).format("yyyymmdd");b.getReservacion(e.cliente.idContrato).success(X).error(k),b.getEvento(e.cliente.idContrato,t,n).success(Z).error(k),$("#showSala").modal("show")}else a.error("Debe seleccionar un cliente.")};var oe=function(e,t,n,r){null!=e?(o.listaEnviosRecibidos=e,a.success("Envios recibidos cargados.")):a.error("Error al obtener los registros.")},te=function(e,t,n,r){null!=e?(o.listaEnviosEntregados=e,a.success("Envios entregados cargados.")):a.error("Error al obtener los registros.")};e.AdminEnvio=function(){if(null!=e.cliente&&""!=e.cliente){$("#myTabEnvio a").click(function(e){e.preventDefault(),$(this).tab("show")});var t=(new Date).addDays(-7).format("yyyymmdd"),n=(new Date).format("yyyymmdd");o.listaEnviosRecibidos=null,p.getRecibido(e.cliente.idContrato).success(oe).error(k),p.getEntregado(e.cliente.idContrato,t,n).success(te).error(k),$("#showEnvio").modal("show")}else a.error("Debe seleccionar un cliente.")},e.NuevoEnvio=function(){location.href="/envioMain"};var ae=function(t,n,r,i){o.listaEnviosRecibidos=null,o.listaEnviosEntregados=null,p.getRecibido(e.cliente.idContrato).success(oe).error(k),a.success("Envio eliminado correctamente")};e.CancelarEnvio=function(o){confirm("¿Desea cancelar este envío?")&&p.cancelar(o.idEnvio,e.empleado.idEmpleado).success(ae).error(k)},e.AltaConsumo=function(){$("#viewConsumo").modal("hide"),e.myData=[],angular.forEach(e.listaContacto,function(e,o){var t=new h;t.name=e.nombre,t.mail=e.mail,""!=t.mail&&this.push(t)},e.myData),$("#tConsumo").autocomplete({source:o.productosConsumo}),e.tempProducto.idProducto=0,e.tempProducto.descripcion="",e.tempProducto.cantidad=0,e.tempProducto.precio=0;var t=(new Date).getTime();e.tempProducto.firma=t.toString(),$("#firmaConsumo").attr("src",global_settings.urlSignature+t.toString()),$("#newConsumo").modal("show"),$("#tConsumo").autocomplete("option","appendTo",".eventInsForm2")};var ne=function(o,t,n,r){a.success("Consumo cancelado.");var i=(new Date).addDays(-7).format("yyyymmdd"),c=(new Date).format("yyyymmdd");f.getConsumo(e.cliente.idContrato,i,c).success(getConsumoListaSuccess).error(k)};e.CancelarConsumo=function(e){confirm("¿Desea eliminar este consumo?")&&f.cancelar(e.idConsumo).success(ne).error(k)};var re=function(e,o,t,n){null!=e?($("#btnGuardarConsumo").button("reset"),$("#newConsumo").modal("hide"),a.success("Consumo Guardado")):a.error("Error al guardar el consumo.")};e.GuardarConsumo=function(){var o=[];angular.forEach(e.gridOptions.selectedItems,function(e,t){o.push(e.mail)}),o.length>0?($("#btnGuardarConsumo").button("loading"),e.listaContactoTemp=Enumerable.From(e.listaContacto).Where(function(e){return $.inArray(e.mail,o)>-1}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).ToArray(),e.tempProducto.contactos=e.listaContactoTemp,e.tempProducto.idContrato=e.cliente.idContrato,e.tempProducto.idEmpleado=e.empleado.idEmpleado,e.tempProducto.precio=e.producto.pesos,f.add(e.tempProducto).success(re).error(k),e.cliente.consumos=e.cliente.consumos+1):a.error("Debe seleccionar un contacto.")},e.ClearConsumo=function(){$("#tConsumo").val("")},e.AjustaPrecio=function(){e.tempProducto.precio=e.tempProducto.cantidad*e.producto.pesos},getConsumoListaSuccess=function(e,t,n,r){a.success("Consumos Cargados"),o.consumoLista=e},e.AdminConsumo=function(){if(null!=e.cliente&&""!=e.cliente){$("#viewConsumo").modal("show");var t=(new Date).addDays(-7).format("yyyymmdd"),n=(new Date).format("yyyymmdd");o.consumoLista=null,f.getConsumo(e.cliente.idContrato,t,n).success(getConsumoListaSuccess).error(k)}else a.error("Debe seleccionar un cliente.")},e.AdminGeneral=function(){null!=e.cliente&&""!=e.cliente?(e.clienteTipoPersona=e.cliente.idTipoFiscal,e.labelClienteTipoPersona=e.cliente.tipoFiscal,$("#viewGeneral").modal("show")):a.error("Debe seleccionar un cliente.")};var ie=function(n,r,i,c){o.listadeClientes=n,t.set("listadeClientes",o.listadeClientes),e.cliente=Enumerable.From(o.listadeClientes).Where(function(o){return o.idActa==e.idCliente}).OrderBy(function(e){return e.idActa}).Select(function(e){return e}).FirstOrDefault(),$("#btnGuardaGeneral").button("reset"),$("#viewGeneral").modal("hide"),a.success("Datos actualizados.")},ce=function(o,t,n,r){isNumber(o)?e.myPromise=c.getFull().success(ie).error(k):a.error("Error interno al guardar: "+o)};e.GuardaGeneral=function(){$("#btnGuardaGeneral").button("loading"),e.cliente.idTipoFiscal=e.clienteTipoPersona,e.cliente.tipoFiscal=e.labelClienteTipoPersona,c.update(e.cliente).success(ce).error(k)},e.SetClienteTipoPersona=function(o,t,a){t.preventDefault(),t.stopPropagation(),e.status.isopenClienteTipoPersona=!e.status.isopenClienteTipoPersona,e.clienteTipoPersona=o,e.labelClienteTipoPersona=a},e.AdminServicios=function(){null!=e.cliente&&""!=e.cliente?($("#tServicio").autocomplete({source:o.productosConsumo}),e.tempProducto.idContrato=e.cliente.idContrato,e.tempProducto.idProducto=0,e.tempProducto.descripcion="",e.tempProducto.cantidad=0,e.tempProducto.precio=0,$("#viewServicios").modal("show"),$("#tServicio").autocomplete("option","appendTo",".eventInsForm")):a.error("Debe seleccionar un cliente.")};var se=function(e,o,t,n){isNumber(e)?d.getServicios().success(le).error(k):a.error("Error interno al guardar: "+e)};e.EliminarServicio=function(e){confirm("¿Desea eliminar este servicio de contrato?")&&d["delete"](e).success(se).error(k)},e.ClearServicio=function(){e.semillaServicio=""};var le=function(n,r,i,c){t.set("listadeServicios",n),o.listadeServicios=t.get("listadeServicios"),e.listaServicio=Enumerable.From(o.listadeServicios).Where(function(o){return o.idActa==e.cliente.idActa}).OrderBy(function(e){return e.idContratoPlan}).Select(function(e){return e}).ToArray(),$("#btnAgregaServicio").button("reset"),a.success("Datos actualizados.")},de=function(e,o,t,n){isNumber(e)?d.getServicios().success(le).error(k):a.error("Error interno al guardar: "+e)};e.AgregaServicio=function(){$("#btnAgregaServicio").button("loading"),d.add(e.tempProducto).success(de).error(k)};var ue=function(o,t,a,n){e.tempContacto=o,e.labelContactoTipo="Seleccione una opción",$("#btnActualizaContacto").hide(),$("#viewContactos").modal("show")};e.AdminContactos=function(){null!=e.cliente&&""!=e.cliente?s.getEmpty().success(ue).error(k):a.error("Debe seleccionar un cliente.")},e.CargaContacto=function(t){e.tempContacto=Enumerable.From(o.listadeContactos).Where(function(e){return e.idContacto==t}).OrderBy(function(e){return e.idContacto}).Select(function(e){return e}).FirstOrDefault(),e.contactoTipo=e.tempContacto.idTipo,e.labelContactoTipo=e.tempContacto.tipo,$("#btnActualizaContacto").show()};var me=function(e,o,t,n){$("#btnActualizaContacto").button("reset"),isNumber(e)?($("#btnActualizaContacto").button("loading"),s.getEmpty().success(ue).error(k),s.getAll().success(ge).error(k),a.success("Contacto actualizado."),$("#btnActualizaContacto").hide(),$("#btnAgregaContacto").show()):a.error("Error interno al actualizar el contacto: "+e)};e.ActualizaContacto=function(o){$("#btnActualizaContacto").button("loading"),e.tempContacto.idTipo=e.contactoTipo,s.update(e.tempContacto).success(me).error(k)};var pe=function(e,o,t,n){$("#btnAgregaContacto").button("reset"),isNumber(e)?($("#btnAgregaContacto").button("loading"),s.getEmpty().success(ue).error(k),s.getAll().success(ge).error(k),a.success("Contacto agregado.")):a.error("Error interno al actualizar el contacto: "+e)},fe=function(){var o=!0;return null==e.contactoTipo&&(o=!1,a.error("Debe elegir el tipo de contacto.")),null==e.tempContacto.nombre&&(o=!1,a.error("Debe establecer el nombre del contacto.")),null==e.tempContacto.apellidoPaterno&&(o=!1,a.error("Debe establecer el Apellido Paterno del contacto.")),null==e.tempContacto.apellidoMaterno&&(o=!1,a.error("Debe establecer el Apellido Materno del contacto.")),null==e.tempContacto.mail&&(o=!1,a.error("Debe establecer el mail del contacto.")),o};e.AgregaContacto=function(o){fe()&&($("#btnAgregaContacto").button("loading"),e.tempContacto.idActa=e.cliente.idActa,e.tempContacto.idTipo=e.contactoTipo,s.add(e.tempContacto).success(pe).error(k))};var ge=function(e,a,n,r){$("#btnActualizaContacto").button("reset"),$("#btnAgregaContacto").button("reset"),o.listadeContactos=e,t.set("listadeContactos",o.listadeContactos),v()},Ce=function(e,o,t,n){isNumber(e)?(s.getAll().success(ge).error(k),a.success("Contacto eliminado.")):a.error("Error interno al eliminar el contacto: "+e)};e.EliminarContacto=function(e){confirm("¿Desea actualizar los datos del cliente? (Esta acción será notificada al supervisor)")&&($("#btnActualizaContacto").button("loading"),s["delete"](e).success(Ce).error(k))},e.SetContactoTipo=function(o,t,a){t.preventDefault(),t.stopPropagation(),e.status.isopencontactotipo=!e.status.isopencontactotipo,e.contactoTipo=o,e.labelContactoTipo=a};var be=function(o,t,a,n){e.tempDireccion=o,e.labelDireccionTipo="Seleccione una opción",e.labelDireccionEstado="Seleccione una opción",$("#btnActualizaDireccion").hide(),$("#viewDirecciones").modal("show")};e.AdminDirecciones=function(){null!=e.cliente&&""!=e.cliente?l.getEmpty().success(be).error(k):a.error("Debe seleccionar un cliente.")},e.CargaDireccion=function(t){e.tempDireccion=Enumerable.From(o.listadeDirecciones).Where(function(e){return e.idDireccion==t}).OrderBy(function(e){return e.idDireccion}).Select(function(e){return e}).FirstOrDefault(),e.direccionTipo=e.tempDireccion.idTipoDireccion,e.labelDireccionTipo=e.tempDireccion.tipoDireccion,e.direccionEstado=e.tempDireccion.idEstado,e.labelDireccionEstado=e.tempDireccion.estado,$("#btnActualizaDireccion").show(),$("#btnAgregaDireccion").hide()};var ve=function(e,o,t,n){$("#btnActualizaDireccion").button("reset"),isNumber(e)?($("#btnActualizaDireccion").button("loading"),l.getEmpty().success(be).error(k),l.get().success(Ee).error(k),a.success("Direccion actualizada."),$("#btnActualizaDireccion").hide(),$("#btnAgregaDireccion").show()):a.error("Error interno al actualizar la dirección: "+e)};e.ActualizaDireccion=function(o){$("#btnActualizaDireccion").button("loading"),e.tempDireccion.idTipoDireccion=e.direccionTipo,e.tempDireccion.idEstado=e.direccionEstado,l.update(e.tempDireccion).success(ve).error(k)};var ye=function(e,o,t,n){$("#btnAgregaDireccion").button("reset"),isNumber(e)?($("#btnAgregaDireccion").button("loading"),l.getEmpty().success(be).error(k),l.get().success(Ee).error(k),a.success("Direccion agregada.")):a.error("Error interno al actualizar la dirección: "+e)},he=function(){var o=!0;return null==e.direccionEstado&&(o=!1,a.error("Debe elegir el estado.")),null==e.direccionTipo&&(o=!1,a.error("Debe elegir el tipo de dirección.")),null==e.tempDireccion.calle&&(o=!1,a.error("Debe establecer la calle.")),null==e.tempDireccion.numeroExterior&&(o=!1,a.error("Debe establecer el número exterior.")),null==e.tempDireccion.colonia&&(o=!1,a.error("Debe establecer la colonia.")),null==e.tempDireccion.codigoPostal&&(o=!1,a.error("Debe establecer el código postal.")),null==e.tempDireccion.ciudad&&(o=!1,a.error("Debe establecer la ciudad.")),o};e.AgregaDireccion=function(o){he()&&($("#btnAgregaDireccion").button("loading"),e.tempDireccion.idActa=e.cliente.idActa,e.tempDireccion.idTipoDireccion=e.direccionTipo,e.tempDireccion.idEstado=e.direccionEstado,l.add(e.tempDireccion).success(ye).error(k))};var Ee=function(e,a,n,r){$("#btnActualizaDireccion").button("reset"),$("#btnAgregaDireccion").button("reset"),o.listadeDirecciones=e,t.set("listadeDirecciones",o.listadeDirecciones),v()},De=function(e,o,t,n){isNumber(e)?(l.get().success(Ee).error(k),a.success("Direccion eliminada.")):a.error("Error interno al eliminar la dirección: "+e)};e.EliminarDireccion=function(e){confirm("¿Desea actualizar los datos del cliente? (Esta acción será notificada al supervisor)")&&($("#btnActualizaDireccion").button("loading"),l["delete"](e).success(De).error(k))},e.SetDireccionEstado=function(o,t,a){t.preventDefault(),t.stopPropagation(),e.status.isopendireccionestado=!e.status.isopendireccionestado,e.direccionEstado=o,e.labelDireccionEstado=a},e.SetDireccionTipo=function(o,t,a){t.preventDefault(),t.stopPropagation(),e.status.isopendirecciontipo=!e.status.isopendirecciontipo,e.direccionTipo=o,e.labelDireccionTipo=a},e.SetContratoSucursal=function(o,t,a){t.preventDefault(),t.stopPropagation(),e.status.isopencontratosucursal=!e.status.isopencontratosucursal,e.contratoSucursal=o,e.labelContratoSucursal=a},e.SetContratoTipo=function(o,t,a){t.preventDefault(),t.stopPropagation(),e.status.isopencontratotipo=!e.status.isopencontratotipo,e.contratoTipo=o,e.labelContratoTipo=a},e.SetContratoEstatus=function(o,t,a){t.preventDefault(),t.stopPropagation(),e.status.isopencontratoestatus=!e.status.isopencontratoestatus,e.contratoEstatus=o,e.labelContratoEstatus=a},e.AdminContratoHeader=function(){null!=e.cliente&&""!=e.cliente?(e.contratoTipo=e.cliente.idTipo,e.labelContratoTipo=e.cliente.tipo,e.contratoEstatus=e.cliente.idEstatusContrato,e.labelContratoEstatus=e.cliente.estatusContrato,e.contratoSucursal=e.cliente.idSucursal,e.labelContratoSucursal=e.cliente.sucursal,$("#viewHeaderContrato").modal("show")):a.error("Debe seleccionar un cliente.")};var $e=function(e,o,t,n){$("#btnActualizaHeaderContrato").button("reset"),isNumber(e)?($("#btnActualizaHeaderContrato").button("loading"),a.info("Estableciendo configuraciones personalizadas (Esto puede tardar un par de minutos)..."),$("#btnActualizaHeaderContrato").button("reset"),a.warning("La solicitud se ha enviado al administrador para su revisión."),$("#viewHeaderContrato").modal("hide")):a.error("Error interno al actualizar el contrato: "+e)};e.ActualizaHeaderContrato=function(){confirm("¿Desea actualizar los datos del cliente? (Esta acción será notificada al supervisor)")&&($("#btnActualizaHeaderContrato").button("loading"),i.put(e.cliente.idContrato,e.contratoSucursal,e.empleado.idEmpleado,e.contratoTipo,e.contratoEstatus,e.actualizaHeaderObservaciones).success($e).error(k))},e.IrACobranza=function(){null!=e.cliente&&""!=e.cliente?location.href="/cobranza":a.error("Debe seleccionar un cliente.")},h.prototype.name="",h.prototype.mail="",e.myData=[],e.gridOptions={data:"myData",columnDefs:[{field:"name",displayName:"Nombre"},{field:"mail",displayName:"Correo"}],selectedItems:[],keepLastSelected:!1};var Se=function(){e.myData=[],angular.forEach(e.listaContacto,function(e,o){
var t=new h;t.name=e.nombre,t.mail=e.mail,""!=t.mail&&this.push(t)},e.myData)};h.prototype.id=0,h.prototype.fecha="",h.prototype.tipo="",h.prototype.material="",h.prototype.almacenamiento="",e.myAlmacen=[],e.gridAlmacen={data:"myAlmacen",columnDefs:[{field:"fecha",displayName:"Fecha"},{field:"tipo",displayName:"Tipo"},{field:"material",displayName:"Material"},{field:"almacenamiento",displayName:"Almacenamiento"}],selectedItems:[],keepLastSelected:!1},e.OpenWeb=function(){""!=e.cliente.paginaWeb&&window.open("http://"+e.cliente.paginaWeb)},D.prototype.idLE="",D.prototype.LE="",e.myDataLE=[],e.gridOptionsLE={data:"myDataLE",columnDefs:[{field:"idLE",displayName:"id"},{field:"LE",displayName:"Linea Emprendedor"}],selectedItems:[],keepLastSelected:!1},e.SetLE=function(){var t=[];angular.forEach(e.gridOptionsLE.selectedItems,function(e,o){t.push(e.idLE),t.push(e.LE)}),angular.forEach(e.myDataLE,function(o,t){e.gridOptionsLE.selectItem(t,!1)}),t.length>0?2==t.length?(o.newCliente.idLE=t[0],o.newCliente.LE=t[1],$("#newLE").modal("hide")):a.error("Solo puede seleccionar una línea emprendedor"):a.error("Debe seleccionar una Línea Emprendedor")};var Ae=function(o,t,n,r){e.listaLE=o,a.success("Lista de LE cargadas"),e.myDataLE=[],angular.forEach(e.listaLE,function(e,o){var t=new D;t.idLE=e.idLE,t.LE=e.numero,this.push(t)},e.myDataLE),$("#btnShowLE").button("reset"),$("#newLE").modal("show")};e.CargaGridLE=function(){$("#btnShowLE").button("loading"),C.getLEBySucursal(o.newCliente.idSucursal).success(Ae).error(k)},S.prototype.idOficina="",S.prototype.oficina="",e.myDataOficina=[],e.gridOptionsOficina={data:"myDataOficina",columnDefs:[{field:"idOficina",displayName:"id"},{field:"oficina",displayName:"Oficina"}],selectedItems:[],keepLastSelected:!1},e.SetOficina=function(){var t=[];angular.forEach(e.gridOptionsOficina.selectedItems,function(e,o){t.push(e.idOficina),t.push(e.oficina)}),angular.forEach(e.myDataOficina,function(o,t){e.gridOptionsOficina.selectItem(t,!1)}),t.length>0?2==t.length?(o.newCliente.idOficina=t[0],o.newCliente.oficina=t[1],$("#newOficina").modal("hide")):a.error("Solo puede seleccionar una Oficina"):a.error("Debe seleccionar una Oficina")};var we=function(o,t,n,r){e.listaOficina=o,a.success("Lista de Oficinas cargadas"),e.myDataOficina=[],angular.forEach(e.listaOficina,function(e,o){var t=new S;t.idOficina=e.idOficina,t.oficina=e.numero,this.push(t)},e.myDataOficina),$("#btnShowOficina").button("reset"),$("#newOficina").modal("show")};e.CargaGridOficina=function(){$("#btnShowOficina").button("loading"),g.getOficinaBySucursal(o.newCliente.idSucursal).success(we).error(k)},e.CallPad=function(o){$("#btnCallList").popover({html:!0,content:function(){return $("#popoverAgendaContent").html()},title:function(){return $("#popoverAgendaTitle").html()}}),e.padResult="  -  ",$("#divHoldBack").hide(),$("#callPad").modal("show")},e.AddPad=function(o){e.padResult+=o},e.ClearPad=function(){e.padResult="  -  "},e.PutHold=function(o){e.holdControl=o},e.inCall=!1,e.TomarLlamada=function(){e.inCall=!0},e.Colgar=function(){e.inCall=!1}});
